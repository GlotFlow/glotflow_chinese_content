# GlotFlow Content

Static content repository for [GlotFlow Chinese](https://github.com/glotflow/glotflow_chinese) Discover feature.

> **⚠️ IMPORTANT: Source vs Build Output**
>
> | Folder | Purpose | Git Status |
> |--------|---------|------------|
> | `content/` | **SOURCE** - Edit here! YAML/Markdown files | ✅ Tracked |
> | `public/` | **OUTPUT** - Generated by `npm run build` | ❌ Gitignored |
>
> **Never edit `public/` directly** - changes will be lost on next build.
> Always edit source files in `content/` then run `npm run build`.

## Overview

This repository hosts curated Chinese learning content:
- **Books**: Full Chinese texts with chapters (public domain)
- **PageBooks**: Links to external Chinese learning sites
- **Articles**: Standalone Chinese learning articles

Content is written in YAML/Markdown and built into JSON feeds + HTML for the app.

## Quick Start

```bash
# Install dependencies
npm install

# Build content (generates JSON + HTML + copies images)
npm run build

# Validate output
npm run validate

# Build and serve locally
npm run serve
```

## Project Structure

```
glotflow_content/
├── content/
│   ├── _config/
│   │   ├── settings.yaml        # Version, locales
│   │   ├── categories.yaml      # Category definitions
│   │   └── featured.yaml        # Featured item IDs
│   ├── books/
│   │   └── {book-slug}/
│   │       ├── _index.yaml      # Book metadata
│   │       ├── cover.jpg        # Cover image (optional)
│   │       ├── images/          # Chapter images
│   │       │   └── 001.png
│   │       └── chapters/
│   │           └── 001.md       # Chapter content (with frontmatter)
│   ├── pagebooks/
│   │   └── {site-slug}.yaml     # External site entries
│   └── articles/
│       ├── {article-slug}.md    # Article (frontmatter + content)
│       └── images/              # Shared article images
│           └── image.png
├── admin/                       # Sveltia CMS admin UI
├── scripts/                     # Build scripts
├── static/images/               # Shared static images
└── public/                      # Build output (gitignored)
```

## Content Format

### Book Metadata (`books/{book-slug}/_index.yaml`)

```yaml
id: my-book
title:
  zh: 中文标题
  en: English Title
  vi: Tiếng Việt
subtitle:
  zh: 副标题
  en: Subtitle
  vi: Phụ đề
difficulty: HSK1-HSK2
categories: [beginner, stories]
status: ongoing
```

### Chapter (`books/{book-slug}/chapters/001.md`)

```markdown
---
id: "001"
title:
  zh: 第一章
  en: Chapter 1
  vi: Chương 1
---
# 第一章

Chinese content here...

![Image description](../images/001.png)

---

**生词 (New Words):**
- 词语 (cíyǔ) - word
```

### Article (`articles/{article-slug}.md`)

```markdown
---
id: my-article
title:
  zh: 文章标题
  en: Article Title
  vi: Tiêu đề bài viết
difficulty: HSK2-HSK3
categories: [beginner]
---
# 文章标题

Article content here...

![Image](./images/my-image.png)
```

### PageBook (`pagebooks/{site-slug}.yaml`)

```yaml
id: duchinese
title:
  zh: Du Chinese
  en: Du Chinese
homeUrl: https://www.duchinese.net/
difficulty: HSK1-HSK4
categories: [beginner, graded, sites]
```

## Images

Images are stored alongside content for easy editing, then centralized during build for CDN-friendly URLs.

### Source Structure
```
content/
├── books/{book}/images/     # Book-specific images
└── articles/images/         # Shared article images
```

### Using Images in Content

**In book chapters** (`content/books/{book}/chapters/001.md`):
```markdown
![Description](../images/filename.png)
```

**In articles** (`content/articles/my-article.md`):
```markdown
![Description](./images/filename.png)
```

### Build Output (CDN-friendly)
```
public/images/
├── books/{book-slug}/       # {basePath}/images/books/my-book/001.png
└── articles/                # {basePath}/images/articles/my-image.png
```

Image paths are automatically rewritten to absolute URLs during build, including the configured `basePath`.

### Base Path Configuration

For subpath deployments (e.g., GitHub Pages), configure `basePath` in `content/_config/settings.yaml`:

```yaml
# Root deployment (CDN or custom domain)
basePath: ""

# GitHub Pages subpath deployment
basePath: "/glotflow_chinese_content"
```

This ensures image URLs work correctly:
- Root: `/images/books/my-book/001.png`
- Subpath: `/glotflow_chinese_content/images/books/my-book/001.png`

## Multi-Language Support

All text fields support localization with fallback chain: `locale → en → zh`

Supported locales: `zh` (Chinese), `en` (English), `vi` (Vietnamese)

## Admin Interface (Sveltia CMS)

Visit `/admin/` to access Sveltia CMS for visual content editing.

### Local Development (File System Mode)

1. Build and serve: `npm run serve`
2. Open `http://localhost:8080/admin/`
3. Click "Work with local repository"
4. Select the `glotflow_content` folder (project root)
5. Use Chrome/Edge (Firefox/Safari not supported)

### Production (GitHub OAuth)

Sveltia CMS has built-in GitHub OAuth - no external server needed.

1. Ensure `admin/config.yml` has correct repo:
   ```yaml
   backend:
     name: github
     repo: GlotFlow/glotflow_chinese_content
     branch: main
   ```
2. Access via GitHub Pages URL: `https://glotflow.github.io/glotflow_chinese_content/admin/`

## Deployment

Push to `main` branch triggers GitHub Actions:
1. Install dependencies
2. Build JSON feeds + HTML
3. Validate content
4. Deploy to GitHub Pages

## Build Output

After build, `public/` contains:

```
public/
├── discover/
│   └── feed.json              # Main content feed
├── books/
│   └── {book-slug}/
│       ├── _index.json        # Book manifest with chapters
│       ├── cover.jpg          # Cover image (if exists)
│       └── chapters/
│           └── 001.html       # Chapter HTML (converted from MD)
├── articles/
│   └── {article-slug}.html    # Article HTML
├── images/                    # CDN-friendly centralized images
│   ├── books/{book-slug}/     # Book images
│   └── articles/              # Article images
└── admin/                     # CMS interface
```

## License

Content: Various (see individual items)
Code: MIT
